<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>interface-spec</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
<link rel="stylesheet" href="../style.css"></head>
<body><a href="../index.html">[Index]</a><br>
<header id="title-block-header">
<h1 class="title">interface-spec</h1>
</header>
<h1 id="communication-interface-specification-v-0.1.0">Communication
Interface Specification v 0.1.0</h1>
<p><strong><em>NOTE:</em></strong> this document is a preliminary draft
of what is going to be a specification. Many details are still missing
and no examples have been provided yet. This is going to be corrected
soon.</p>
<h2 id="common-definitions-and-convention">Common Definitions And
Convention</h2>
<ol type="1">
<li><strong>Backend</strong> is the program that implements processing
of regular expressions and provides a software interface to execute
these operations on given data and obtain the result of their
execution.</li>
<li><strong>Frontend</strong> is the program that instructs the backend
to execute operations with regular expressions, as requested, directly
or indirectly, by the user, and presents their results, possibly with
some additional post-processing, to the user.</li>
<li><strong>Communication interface</strong> is the interface to the
operations provided by the backend and used by the frontend.</li>
<li><strong>Service error</strong> is an error that prevents a request
from the frontend from being handled by the backend. This category of
errors includes (but is not limited to) I/O errors, errors related to
the syntax or format of ths request or hitting a timeout, but does not
include an unsuccessful result of an operation executed.</li>
<li><strong>Error code</strong> is a unique string that describes a kind
of error.</li>
<li>Terms <strong>JSON object</strong>, <strong>JSON array</strong>,
<strong>JSON number</strong>, <strong>JSON string</strong> are defined
as the corresponding JSON datatypes. The term <strong>JSON
value</strong> corresponds to a value of an arbitrary type (explicitly
including <code>null</code>).</li>
<li>Unless explicitly specified otherwise, the described values cannot
be null.</li>
<li><strong>Bold</strong> text is used to introduce new terms.
<em>Italic</em> text is used to refer to already defined terms.</li>
</ol>
<h2 id="communication-interface">Communication Interface</h2>
<p>The communication interface is defined in this section. The
<em>backend</em> listens on the TCP network socket bound to the IPv4
address <code>127.0.0.1</code> to the port <code>6666</code> and accepts
incoming connections from the <em>frontend</em>. After the TCP
connection has been established, the communication between the
<em>frontend</em> and the <em>backend</em> proceeds over HTTP/1.1. The
<em>frontend</em> makes HTTP requests to the <em>backend</em> and
receives HTTP responses from it.</p>
<p>The set of allowed request paths is limited, and each path represents
an operation with regular expressions. If the <em>frontend</em> requests
a path not defined in this specification, the <em>backend</em> responds
with the 404 Not Found HTTP status code and arbitrary, possibly empty
response body. If the <em>frontend</em> requests a path that is defined
in this specification but uses an HTTP method that is not defined for
this path, the <em>backend</em> responds with the 405 Method Not Allowed
HTTP status code and arbitrary, possibly empty response body, for any
HTTP method except <code>HEAD</code>. The behavior of the
<code>HEAD</code> method is defined as in the <a
href="https://datatracker.ietf.org/doc/rfc2616/">HTTP/1.1
specification</a>.</p>
<p>When requests have a body, it must be a valid JSON document. This
document is referred to as <strong>the request payload</strong>. The
structure of the request payload is defined separately for each request
path.</p>
<p>The response body must be a valid JSON document. The root document
item must be a <em>JSON object</em> with either one or both the
following fields:</p>
<ol type="1">
<li><code>data</code> — A <em>JSON object</em> of the format specific to
the request path. Represents the operation-specific data returned as the
result of its execution. Must be present if <code>error</code> is not
present, but may be present even together with <code>error</code>. This
object is referred to as <strong>the response payload</strong>.</li>
<li><code>error</code> — A <em>JSON object</em> representing an error
(format defined below). Describes the <em>service error</em> that
prevented the execution of the requested operation. Must be present if
and only if a <em>service error</em> has occurred. This field is
referred to as <strong>the response service error object</strong>.</li>
</ol>
<p>If present, the <code>error</code> field is an <strong>error
object</strong>. The latter is defined as a <em>JSON object</em> with
the following fields:</p>
<ol type="1">
<li><code>code</code> — A <em>JSON string</em> that represents the error
code. Must always be present.</li>
<li><code>data</code> — A <em>JSON value</em> of the error-specific
format. The precise format is defined together with the definition of
the corresponding error code. If no definition of the <code>data</code>
field is given for an error code, this field must be absent if such
error is returned.</li>
</ol>
<p>The list of defined request paths is as follows:</p>
<ol type="1">
<li><code>/parse</code></li>
</ol>
<h3 id="request-paths">Request Paths</h3>
<h4 id="parse"><code>/parse</code></h4>
<p>Parse a regular expression into its syntax tree.</p>
<p>Allowed HTTP methods: <code>POST</code>.</p>
<p><em>Request payload</em> fields:</p>
<ol type="1">
<li><code>regex</code> — A JSON string that represents the regular
expression to parse. Must always be present.</li>
</ol>
<p><em>Response payload</em> is a <em>spanned tree node</em> object
corresponding to the root parse tree node. This and other object types
are defined below.</p>
<p>(TODO: check this)</p>
<ol type="1">
<li><strong>Spanned tree node</strong> is a <em>JSON object</em> with
the following fields:
<ol type="1">
<li><code>span</code> — a <em>span</em>. Determines the starting and
ending positions of the current parse tree node in the regular
expression string.</li>
<li>All fields from a <em>tree node</em> object.</li>
</ol></li>
<li><strong>Tree node</strong> is a <em>JSON object</em> with the
following fields:
<ol type="1">
<li><code>type</code> — a <em>JSON string</em> that determines the type
of the tree node.</li>
<li>Other fields depdending on <code>type</code>. The following values
of <code>type</code> are defined:
<ol type="1">
<li><code>alternatives</code> — a list of alternatives
(e.g. “<code>a|b|c</code>” in the regex). Other fields in the <em>tree
node</em> object:
<ol type="1">
<li><code>alternatives</code> — a <em>JSON array</em> of <em>spanned
tree node</em> objects. Each of them represents one alternative.</li>
</ol></li>
<li><code>empty</code> — an empty tree node (matches the empty string).
No other <em>tree node</em> fields are defined.</li>
<li><code>group</code> — a group (e.g. “<code>(foo)</code>” in the
regex). May be capturing or non-capturing, see <a
href="https://writing-regexps-2021-22.github.io/docs/regex-parser/structwr22_1_1regex__parser_1_1regex_1_1part_1_1Group.html">the
reference documentation</a> for details. Other fields in the tree node
object:
<ol type="1">
<li><code>inner</code> — a <em>spanned tree node</em>, which represents
the content of the group.</li>
<li><code>capture</code> — a <em>capture</em> object, which describes
the capturing behavior of this group.</li>
</ol></li>
<li><code>literal</code> — a literal character (e.g. “<code>a</code>”).
Other fields in the <em>tree node</em> object:
<ol type="1">
<li><code>char</code> — a <em>JSON string</em> containing 1 character
(Unicode codepoint). This codepoint is the literal character in the
regular expression.</li>
</ol></li>
<li><code>optional</code>, <code>plus</code>, <code>star</code> —
expressions quantified with <code>?</code>, <code>+</code> and
<code>*</code> respectively. Other fields in the <em>tree node</em>
object:
<ol type="1">
<li><code>inner</code> — a <em>spanned tree node</em> representing the
expression under the quantifier.</li>
</ol></li>
<li><code>sequence</code> — a collection of several subexpressions
following each other sequentially (e.g. “<code>[a-z].abc+</code>” is a
sequence of “<code>[a-z]</code>”, “<code>.</code>”, “<code>a</code>”,
“<code>b</code>” and “<code>c+</code>”). Other fields in the <em>tree
node</em> object:
<ol type="1">
<li><code>items</code> — a <em>JSON array</em> of <em>spanned tree
nodes</em>, each representing a subexpression.</li>
</ol></li>
<li><code>wildcard</code> — a wildcard symbol (“<code>.</code>” in the
regex). No other <em>tree node</em> fields are defined.</li>
</ol></li>
</ol></li>
<li><strong>Capture</strong> is a <em>JSON object</em> describing the
capturing behavior of a group with the following fields:
<ol type="1">
<li><code>type</code> — a <em>JSON string</em> that determines the type
of the capture.</li>
<li>Other fields depdending on <code>type</code>. The following values
of <code>type</code> are defined:
<ol type="1">
<li><code>index</code> — group capturing by index
(e.g. “<code>(foo)</code>”). No other <em>capture</em> fields are
defined.</li>
<li><code>none</code> — non-capturing group
(e.g. “<code>(?:foo)</code>”). No other <em>capture</em> fields are
defined.</li>
<li><code>name</code> — group capturing by name
(e.g. “<code>(?P&lt;name&gt;foo)</code>”). Other fields in the
<em>capture</em> object:
<ol type="1">
<li><code>name</code> — a <em>JSON string</em> representing the name of
the capture.</li>
<li><code>flavor</code> — a <em>JSON string</em> representing the syntax
variant used in the regular expression to declare a group capturing by
name. Possible values:
<ol type="1">
<li><code>apostrophes</code> — corresponds to
“<code>(?'name'data)</code>”.</li>
<li><code>angles</code> — corresponds to
“<code>(?&lt;name&gt;data)</code>”.</li>
<li><code>angles_with_p</code> — corresponds to
“<code>(?P&lt;name&gt;data)</code>”.</li>
</ol></li>
</ol></li>
</ol></li>
</ol></li>
<li><strong>Span</strong> is a <em>JSON array</em> of exactly two
<em>JSON numbers</em>. Each number is an integer, and the second one is
greater than or equal to the first one. These numbers represent the
starting and ending positions of a parse tree node in the regular
expression string: the first number is the 0-based index of the first
Unicode character (codepoint) covered by this tree node, and the second
number is the 0-based index of the Unicode character right after the
last one covered. That is, the left end is included, and the right end
is excluded. For example, in a regex “<code>a(b|c)d</code>” the group
“<code>(b|c)</code>” has the span <code>[1, 6]</code>, because the index
of “<code>(</code>” is 1, and the index of “<code>d</code>” (the
character right after the group) is 6.</li>
</ol>
<h3 id="errors">Errors</h3>
<p>TODO</p>
<h2 id="service-errors">Service Errors</h2>
<p>TODO</p>
</body>
</html>
